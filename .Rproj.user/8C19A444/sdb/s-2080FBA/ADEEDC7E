{
    "contents" : "### Gives P(A > B) by a certain lift\n### Set priors for more informative predictions!\n\nbayes.prop.test <- function(clicks_a, views_a, clicks_b, views_b, alpha = 1, beta = 1, percent_lift = 0, N_samp = 1e6, min_lift = FALSE) {\n  \n  ## Always test bigger proportion against smaller\n#   if(clicks_a / views_a < clicks_b / views_b) {\n#     \n#     t1 <- clicks_b\n#     t2 <- views_b\n#   \n#     clicks_b <- clicks_a\n#     views_b <- views_a\n#     \n#     clicks_a <- t1\n#     views_a <- t2\n#     \n#   }\n  \n  A_samples <- rbeta(N_samp, clicks_a + alpha, views_a - clicks_a + beta)\n  B_samples <- rbeta(N_samp, clicks_b + alpha, views_b - clicks_b + beta)\n  \n  prob <- get.prob(A_samples, B_samples, percent_lift = percent_lift)\n  \n  ans <- 0\n  \n  if(min_lift) {\n      \n      ans <- min.lift(A_samples, B_samples)\n    \n  }\n  \n  list(prob = max(prob, 1 - prob), min.lift = ans)\n  \n}\n\nget.prob <- function(A_samples, B_samples, percent_lift = 0) {\n  \n  prob <- mean((100 * (A_samples - B_samples) / B_samples > percent_lift))\n  \n  prob\n  \n}\n\nmin.lift <- function(A_samples, B_samples) {\n  \n  prob <- get.prob(A_samples, B_samples)\n  \n  ans <- 0\n  \n  if(max(prob, 1 - prob) < .95) {\n    \n    return(ans)\n    \n  }\n  \n  else {\n    \n    p <- prob\n    upper <- 100\n    lower <- -100\n    attempts <- 0\n    \n    while(abs(p - .95) > .001) {\n    \n      step <- mean(c(lower, upper))\n      \n      p <- get.prob(A_samples, B_samples, percent_lift = step)\n      \n      if(p > .95) lower <- step\n      \n      if(p < .95) upper <- step\n      \n      if(attempts == 1000) {\n        \n        return(step)\n        \n      }\n      \n      attempts <- attempts + 1\n      \n    }\n    \n    return(step)\n    \n  }\n  \n}\n\n# bayes.prop.test(250, 500, 200, 500, min_lift = FALSE)\n# bayes.prop.test(250, 500, 200, 500, min_lift = TRUE)\n# \n# bayes.prop.test(250, 500, 200, 500, percent_lift = 50)\n# \n# bayes.prop.test(450, 860, 300, 1000, min_lift = FALSE)\n# bayes.prop.test(450, 860, 300, 1000, min_lift = TRUE)\n\n\n",
    "created" : 1422736745313.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2496806852",
    "id" : "ADEEDC7E",
    "lastKnownWriteTime" : 1422652427,
    "path" : "~/customerjourney/edmundsBayes/R/bayes.prop.test.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}